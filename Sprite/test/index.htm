<!DOCTYPE html>
<html>
	<head>
		<title>Test</title>
		<link rel='icon' href='data:;base64,iVBORw0KGgo='>
		<meta charset='UTF-8'>
		<script>
			function c(text) {
				console.log(text);
			}
		</script>
		<script src='../../Main/Main.js'></script>
		<script src='../Sprite.js'></script>
		<script src='../Pivot.js'></script>
		<script src='../Mngr.js'></script>
		<script src='../AnimateMngr.js'></script>
		<script src='../ClipLayerMngr.js'></script>
		<script src='../ClipMngr.js'></script>
		<script src='../TileMngr.js'></script>
		<script src='../StaticMngr.js'></script>
		<script>
			
			let charImg   = new Image();
			charImg.src   = 'char.png';
			let charAImg  = new Image();
			charAImg.src  = 'char_animation.png';
			let charLImg  = new Image();
			charLImg.src  = 'layers.png';
			
			let char, achar, lchar;
			let cvs;
			let ctx;
			
			function draw(offsetX, offsetY, input, pivotText, img = null) {
				ctx.setTransform(1, 0, 0, 1, offsetX, offsetY);
				if ( img === null ) {
					char.draw(ctx, ...input);
				} else {
					img.draw(ctx, ...input);
				}
				ctx.fillText('Pivot: ' + pivotText, 0, 15);
				ctx.rect(-3, -3, 6, 6);
				ctx.stroke();
			}
			
			function text(text, x, y) {
				ctx.setTransform(1, 0, 0, 1, x, y);
				ctx.fillText(text, 0, 15);
			}
			
			function main() {
				cvs   = document.getElementById('canvas');
				ctx   = cvs.getContext('2d');
				char  = new QQ.Sprite(charImg);
				achar = new QQ.Sprite(charAImg);
				achar.setAnimation(107, 148, 3);
				lchar = new QQ.Sprite(charLImg);
				lchar.setClipLayer(0, 0, 171, 150);
				lchar.addClipLayer(171, 0);
				lchar.addClipLayer(418, 75, 16, 16);
				frame();
			}
			
			function frame() {
				requestAnimationFrame(frame);
				ctx.setTransform(1, 0, 0, 1, 0, 0);
				ctx.clearRect(0, 0, cvs.width, cvs.height);
				
				// STATIC
				char.setStatic();
				draw(60, 75,   [QQ.Sprite.Pivot.CENTER],       'CENTER');
				draw(150, 5,   [QQ.Sprite.Pivot.LEFTTOP],      'LEFTTOP');
				draw(340, 150, [QQ.Sprite.Pivot.CENTERBOTTOM], 'CENTERBOTTOM');
				draw(480, 5,   [QQ.Sprite.Pivot.CENTERTOP],    'CENTERTOP');
				char.setAlpha(0.5);
				draw(630, 75,  [], 'default');
				text('Alpha 0.5', 630, 85);
				char.setAlpha(1);
				draw(750, 75,  [-53, -74], '-53, -74');
				text('Image ratio: ' + char.getRatio(),       0, 170);
				text('Image width ' + char.getSize().width,  0, 190);
				text('Image height: ' + char.getSize().height, 0, 210);
				
				// CLIP
				char.setClip(49, 43, 28, 45);
				draw(60, 275,  [QQ.Sprite.Pivot.CENTER],       'CENTER');
				draw(150, 255, [QQ.Sprite.Pivot.LEFTTOP],      'LEFTTOP');
				draw(340, 300, [QQ.Sprite.Pivot.CENTERBOTTOM], 'CENTERBOTTOM');
				draw(480, 250, [QQ.Sprite.Pivot.CENTERTOP],    'CENTERTOP');
				char.setAlpha(0.5);
				draw(630, 275, [], 'default');
				text('Alpha 0.5', 630, 285);
				char.setAlpha(1);
				draw(750, 275, [-20, -15], '-20, -15');
				text('Image ratio: ' + char.getRatio(),       0, 370);
				text('Image width ' + char.getSize().width,  0, 390);
				text('Image height: ' + char.getSize().height, 0, 410);
				
				// ANIMATE
				draw(60,  525, [QQ.Sprite.Pivot.CENTER],       'CENTER', achar);
				draw(150, 450, [QQ.Sprite.Pivot.LEFTTOP],      'LEFTTOP', achar);
				draw(340, 600, [QQ.Sprite.Pivot.CENTERBOTTOM], 'CENTERBOTTOM', achar);
				draw(480, 450, [QQ.Sprite.Pivot.CENTERTOP],    'CENTERTOP', achar);
				achar.setAlpha(0.5);
				draw(630, 525, [], 'default', achar);
				text('Alpha 0.5', 630, 535);
				achar.setAlpha(1);
				draw(725, 470, [-20, -15], '-20, -15', achar);
				text('Image ratio: ' + achar.getRatio(),       0, 600);
				text('Image width ' + achar.getSize().width,  0, 615);
				text('Image height: ' + achar.getSize().height, 0, 630);
				
				// LAYERS
				draw(100, 750, [QQ.Sprite.Pivot.CENTER],       'CENTER', lchar);
				draw(200, 675, [QQ.Sprite.Pivot.LEFTTOP],      'LEFTTOP', lchar);
				draw(500, 830, [QQ.Sprite.Pivot.CENTERBOTTOM], 'CENTERBOTTOM', lchar);
				draw(700, 675, [QQ.Sprite.Pivot.CENTERTOP],    'CENTERTOP', lchar);
				lchar.setAlpha(0.5);
				draw(900, 750, [], 'default', lchar);
				text('Alpha 0.5', 900, 760);
				lchar.setAlpha(1);
				draw(1025, 700, [-20, -15], '-20, -15', lchar);
				text('Image ratio: ' + lchar.getRatio(),       0, 850);
				text('Image width ' + lchar.getSize().width,  0, 865);
				text('Image height: ' + lchar.getSize().height, 0, 880);
				
				// TILE
				//char.setTileSize(30, 30, 100, 50);
				char.setTileSize(50, 30, 100, 50);
				draw(60,  950, [QQ.Sprite.Pivot.CENTER],       'CENTER');
				draw(200, 930, [QQ.Sprite.Pivot.LEFTTOP],      'LEFTTOP');
				draw(400, 970, [QQ.Sprite.Pivot.CENTERBOTTOM], 'CENTERBOTTOM');
				draw(600, 930, [QQ.Sprite.Pivot.CENTERTOP],    'CENTERTOP');
				char.setAlpha(0.5);
				draw(800, 950, [], 'default');
				text('Alpha 0.5', 800, 960);
				char.setAlpha(1);
				draw(1000, 950, [-20, -15], '-20, -15');
				text('Image ratio: ' + char.getRatio(),       0, 1000);
				text('Image width ' + char.getSize().width,  0, 1010);
				text('Image height: ' + char.getSize().height, 0, 1020);
			}
		</script>
	</head>
	<body onload='main()'>
		<canvas id='canvas' width='1300' height='1200'></canvas>
	</body>
</html>
